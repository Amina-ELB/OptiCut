

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compliance minimization &mdash; OptiCut 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=bfa8c73d" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=29a6c3e3"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lp norm of Von Mises criteria minimization" href="demo_vonMises.html" />
    <link rel="prev" title="Demos" href="demos.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            OptiCut
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="demo_optim.html">Shape optimization method</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_cutfem.html">CutFEM for Immersed geometry discretization</a></li>
<li class="toctree-l1"><a class="reference internal" href="demo_cutfem_optim.html">Shape optimization with CutFEM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="demos.html">Demos</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compliance minimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#problem-definition">Problem definition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#shape-derivative">Shape derivative</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application">Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization-of-all-parameters">Initialization of all parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mesh-generation">Mesh Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization-of-the-spaces">Initialization of the spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization-of-the-level-set">Initialization of the level set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization-of-the-boundary-conditions">Initialization of the boundary conditions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instantiation-of-the-objects">Instantiation of the objects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instantiation-of-problem-class">Instantiation of Problem class</a></li>
<li class="toctree-l4"><a class="reference internal" href="#resolution-of-linear-elasticity">Resolution of linear elasticity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shape-derivative-computation">Shape derivative computation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-alm-parameters">Update ALM parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compute-the-descent-direction">Compute the descent direction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advection-of-the-level-set-function">Advection of the level set function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reinitialization-of-the-level-set">Reinitialization of the level set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-all-the-parameters">Update all the parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cutfem-solution">CutFEM solution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ersatz-solution">Ersatz solution</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="demo_vonMises.html">Lp norm of Von Mises criteria minimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OptiCut</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="demos.html">Demos</a></li>
      <li class="breadcrumb-item active">Compliance minimization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/demo_compliance.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="compliance-minimization">
<span id="demo"></span><h1>Compliance minimization<a class="headerlink" href="#compliance-minimization" title="Link to this heading"></a></h1>
<p>Minimizing the compliance of a structure is a classic problem that has been the subject of numerous studies.</p>
<section id="problem-definition">
<h2>Problem definition<a class="headerlink" href="#problem-definition" title="Link to this heading"></a></h2>
<p>We seek the optimal shape, <span class="math notranslate nohighlight">\(\widetilde{\Omega}\subset D\)</span>, that minimizes the compliance of the structure for a linear elastic material subject to Dirichlet and Neumann boundary conditions.
We impose a target area on the structure, which results in the addition of an equality constraint.
The optimization problem is defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}\begin{cases}
\underset{\Omega\in\mathcal{O}}{\min}J(\Omega) &amp; \!\!\!\!=\underset{\Omega\in\mathcal{O}}{\min}\int_{\Omega}(\mu\varepsilon(u):\varepsilon(u)+\frac{\lambda}{2}\nabla\cdot u\nabla\cdot u)\text{ }dx\\
C(\Omega) &amp; \!\!\!\!=0\\
a\left(u,v\right) &amp; \!\!\!\!=l\left(v\right)
\end{cases}\end{align}\end{split}\]</div>
<p>u is the displacement field solution to PDE equation and the constraint over the area is defined as:</p>
<div class="math notranslate nohighlight">
\[C(\Omega)=\int_{\Omega}dx - \overline{V}\]</div>
<p>with <span class="math notranslate nohighlight">\(\overline{V}\)</span> the target volume.</p>
<section id="shape-derivative">
<h3>Shape derivative<a class="headerlink" href="#shape-derivative" title="Link to this heading"></a></h3>
<p>Using the Céa method the shape derivative of the compliance minimization problem is defined as :</p>
<div class="math notranslate nohighlight">
\[\begin{align}
J'(\Omega)(\theta) &amp;= -\int_{\partial\Omega}\theta\cdot n[ \mu\varepsilon(u_{\Omega}):\varepsilon(u_{\Omega})+\frac{\lambda}{2}(\nabla\cdot u_{\Omega})(\nabla\cdot u_{\Omega})]\text{ }ds
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the unit normal.</p>
<p>To account for the constraint in the optimization, the ALM (see <a class="reference internal" href="demo_optim.html#alm"><span class="std std-ref">Augmented lagrangian Method</span></a> ) is used.
First, we define the modified cost function as:</p>
<div class="math notranslate nohighlight">
\[\begin{align}
\mathcal{J}(\Omega) &amp;= J(\Omega) +\alpha C(\Omega)+\frac{\beta}{2} C^{2}(\Omega).
\end{align}\]</div>
<p>Then, we calculate the shape derivative of this new function.
We obtain the following shape derivative:</p>
<div class="math notranslate nohighlight">
\[\begin{align}
\mathcal{J}'(\Omega)(\theta) &amp;= J'(\Omega)(\theta) +\alpha C'(\Omega)(\theta) +\beta C(\Omega)C'(\Omega)(\theta).
\end{align}\]</div>
<p>Using the shape optimization algorithm, the descent direction is directly defined as:</p>
<div class="math notranslate nohighlight">
\[v(u_{\Omega}) = 2\mu\varepsilon(u_{\Omega}):\varepsilon(u_{\Omega})+\lambda(\nabla\cdot u_{\Omega})(\nabla\cdot u_{\Omega}) + \alpha+\beta C(\Omega).\]</div>
</section>
</section>
<section id="algorithm">
<h2>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading"></a></h2>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{l}
\textbf{BEGIN} \\
    \quad u_{h} \gets \text{Resolution of Primal problem (elasticity linear): } a\left(u,v\right)=l\left(v\right)\\
\quad \text{WHILE } \left\Vert J\left(\Omega_{n+1}\right)-J\left(\Omega_{n}\right)\right\Vert &lt;tol \text{:} \\
\quad \quad n \gets n+1 \\
    \quad \quad \lambda_{ALM}^{n},\mu_{ALM}^{n} \gets \text{ Update ALM parameters}\\
    \quad \quad v \gets \text{Explicit calculation of the velocity, defined on }\Gamma \\
    \quad \quad v_{ext} \gets \text{Extension of the velocity in } D\\
    \quad \quad v_{\text{reg}} \gets \text{Normalization of the velocity} \\
    \quad \quad \text{WHILE  adv_NAN}\neq1 \\
\quad \quad \quad \phi_{\text{temp}} \gets \text{Advection }\\
    \quad \quad \quad \phi_{\text{temp}} \gets \text{Reinitialization}\\
    \quad \quad \quad u_{h} \gets \text{Resolution of Primal problem (elasticity linear): } a\left(u,v\right)=l\left(v\right)\\
    \quad \quad \quad \text{dt, } j_{\text{max}} \text{, adv_NAN} \gets \text{Update parameters}\\
    \quad \quad \phi \gets \phi_{temp}\\
\textbf{END}\\
\end{array}\end{split}\]</div>
</section>
<section id="application">
<h2>Application<a class="headerlink" href="#application" title="Link to this heading"></a></h2>
<p>We study the case of an embedded steel beam of <span class="math notranslate nohighlight">\(1\text{m}\times 2\text{m}\)</span> subjected to a uniformly distributed tensile load at <span class="math notranslate nohighlight">\(\pm 0.5\)</span> m such that <span class="math notranslate nohighlight">\(g=-0.1 e_{y}\)</span> GPa.
The numerical values used as parameters in the mechanical model are detailed in the <a class="reference internal" href="#parammeca"><span class="std std-numref">Table 1</span></a>.
The domain <span class="math notranslate nohighlight">\(\Omega\)</span> included in <span class="math notranslate nohighlight">\(D\)</span> is initialized as shown in <a class="reference internal" href="#compliancedomain"><span class="std std-numref">Figure 13</span></a>, and it is discretized with a <span class="math notranslate nohighlight">\(100\times200\)</span> finite element mesh.
The problem is solved with a target area of <span class="math notranslate nohighlight">\(1.2 \text{ m}^{2}\)</span> and an initial area of <span class="math notranslate nohighlight">\(1.64m^{2}\)</span>.
The optimal shape obtained is shown in <a class="reference internal" href="#finalrescutfem"><span class="std std-ref">CutFEM solution</span></a> with CutFEM method and in <a class="reference internal" href="#finalresersatz"><span class="std std-ref">Ersatz solution</span></a> for Ersatz method.</p>
<div class="images-row docutils container">
<div class="centered-figure docutils container">
<figure class="align-center" id="id1">
<span id="compliancedomain"></span><a class="reference internal image-reference" href="_images/domain.png"><img alt="_images/domain.png" src="_images/domain.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 13 </span><span class="caption-text">Initialization of <span class="math notranslate nohighlight">\(\Omega\subset\text{D}\)</span></span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
<div class="centered-figure docutils container">
<figure class="align-center" id="id2">
<span id="mesh"></span><a class="reference internal image-reference" href="_images/mesh.png"><img alt="_images/mesh.png" src="_images/mesh.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 14 </span><span class="caption-text">Initialization of the mesh.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
<span id="parammeca"></span><table class="docutils align-center" id="id3">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Mechanical parameters</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
<th class="head"><p><strong>Unity</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>E (Young Modulus)</p></td>
<td><p>210</p></td>
<td><p><strong>GPa</strong></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\nu\)</span></p></td>
<td><p>0.33</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Strength</p></td>
<td><p>0.1</p></td>
<td><p><strong>GPa</strong></p></td>
</tr>
</tbody>
</table>
<section id="initialization-of-all-parameters">
<h3>Initialization of all parameters<a class="headerlink" href="#initialization-of-all-parameters" title="Link to this heading"></a></h3>
<p>The first step is to instantiate the Parameter object and then initialize all of its attributes using the provided data file named “param_compliance.txt”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;compliance&quot;</span><span class="p">)</span>
<span class="linenos">2</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;param_compliance.txt&quot;</span>
<span class="linenos">3</span><span class="n">parameters</span><span class="o">.</span><span class="n">set__paramFolder</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mesh-generation">
<h3>Mesh Generation<a class="headerlink" href="#mesh-generation" title="Link to this heading"></a></h3>
<p>Then to generate the rectangular mesh seen in <a class="reference internal" href="#mesh"><span class="std std-numref">Figure 14</span></a> the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">create_mesh.create_mesh_2D()</span></code> is called.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span><span class="w"> </span><span class="nn">create_mesh</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">msh</span> <span class="o">=</span> <span class="n">create_mesh_2D</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">lx</span><span class="p">,</span> <span class="n">parameters</span><span class="o">.</span><span class="n">ly</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">lx</span><span class="o">/</span><span class="n">parameters</span><span class="o">.</span><span class="n">h</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">ly</span><span class="o">/</span><span class="n">parameters</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="initialization-of-the-spaces">
<h3>Initialization of the spaces<a class="headerlink" href="#initialization-of-the-spaces" title="Link to this heading"></a></h3>
<p>Next, we generate the spaces for all the functions that will be used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">V</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">msh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="p">)))</span>
<span class="linenos">2</span><span class="n">V_vm</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">msh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="p">)))</span>
<span class="linenos">3</span><span class="n">V_ls</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Lagrange&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">4</span><span class="n">Q</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="linenos">5</span><span class="n">V_DG</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">msh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="p">)))</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="c1"># Initialization of the spacial coordinate</span>
<span class="linenos">8</span><span class="n">x</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">msh</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="initialization-of-the-level-set">
<h3>Initialization of the level set<a class="headerlink" href="#initialization-of-the-level-set" title="Link to this heading"></a></h3>
<p>To initialize the level set function, we use the module <code class="xref py py-meth docutils literal notranslate"><span class="pre">geometry_initialization()</span></code> and the function :  <code class="xref py py-meth docutils literal notranslate"><span class="pre">geometry_initialization.level_set()</span></code>.
In this module, we define all the desired initializations for the level set function and adjust the call based on the desired configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span><span class="w"> </span><span class="nn">geometry_initialization</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">ls_func_ufl</span> <span class="o">=</span> <span class="n">geometry_initialization</span><span class="o">.</span><span class="n">level_set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">ls_func_expr</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">ls_func_ufl</span><span class="p">,</span> <span class="n">V_ls</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">interpolation_points</span><span class="p">())</span>
<span class="linenos">5</span><span class="n">ls_func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">V_ls</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">ls_func</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">ls_func_expr</span><span class="p">)</span>
</pre></div>
</div>
<div class="images-row docutils container">
<div class="centered-figure docutils container">
<figure class="align-center" id="id4">
<span id="levelsetinit"></span><a class="reference internal image-reference" href="_images/levelSetInit.png"><img alt="Exemple d'image" src="_images/levelSetInit.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 15 </span><span class="caption-text">Initialization of the level set.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
<div class="centered-figure docutils container">
<figure class="align-center" id="id5">
<span id="levelsetinitwarp"></span><a class="reference internal image-reference" href="_images/levelSetInitWarp.png"><img alt="Exemple d'image" src="_images/levelSetInitWarp.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 16 </span><span class="caption-text">Initialization of the level set warped.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="initialization-of-the-boundary-conditions">
<h3>Initialization of the boundary conditions<a class="headerlink" href="#initialization-of-the-boundary-conditions" title="Link to this heading"></a></h3>
<p>We define the Dirichlet conditions for the linear elasticity problem, denoted <span class="math notranslate nohighlight">\(\Gamma_{D}\)</span> in <a class="reference internal" href="#compliancedomain"><span class="std std-numref">Figure 13</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">dolfinx</span><span class="w"> </span><span class="kn">import</span> <span class="n">fem</span><span class="p">,</span> <span class="n">mesh</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">fdim</span> <span class="o">=</span> <span class="n">msh</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># facet dimension</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">def</span><span class="w"> </span><span class="nf">clamped_boundary_cantilever</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos"> 7</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">boundary_facets</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">locate_entities_boundary</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="n">fdim</span><span class="p">,</span><span class="n">clamped_boundary_cantilever</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">u_D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ScalarType</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">bc</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">dirichletbc</span><span class="p">(</span><span class="n">u_D</span><span class="p">,</span> <span class="n">fem</span><span class="o">.</span><span class="n">locate_dofs_topological</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">fdim</span><span class="p">,</span> <span class="n">boundary_facets</span><span class="p">),</span> <span class="n">V</span><span class="p">)</span>
</pre></div>
</div>
<p>We define the Neumann conditions for the linear elasticity problem, denoted <span class="math notranslate nohighlight">\(\Gamma_{N}\)</span> in
<a class="reference internal" href="#compliancedomain"><span class="std std-numref">Figure 13</span></a>. Then, we define Dirichlet boundary condition for the velocity field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">dolfinx.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">meshtags</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span><span class="w"> </span><span class="nf">load_marker</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos"> 6</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">parameters</span><span class="o">.</span><span class="n">lx</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="mf">0.55</span><span class="p">),</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.45</span><span class="p">)))</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># Boundary condition for the velocity field.</span>
<span class="linenos"> 9</span><span class="n">boundary_dofs</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">locate_dofs_geometrical</span><span class="p">(</span><span class="n">V_ls</span><span class="p">,</span> <span class="n">load_marker</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">bc_velocity</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">dirichletbc</span><span class="p">(</span><span class="n">ScalarType</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">boundary_dofs</span><span class="p">,</span> <span class="n">V_ls</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Neumann boundary condition for the primal problem.</span>
<span class="linenos">13</span><span class="n">facet_indices</span><span class="p">,</span> <span class="n">facet_markers</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="linenos">14</span><span class="n">facets</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">locate_entities</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="n">fdim</span><span class="p">,</span> <span class="n">load_marker</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">facet_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facets</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">facet_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">facets</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">facet_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">facet_indices</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="linenos">19</span><span class="n">facet_markers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">facet_markers</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="linenos">20</span><span class="n">sorted_facets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">facet_indices</span><span class="p">)</span>
<span class="linenos">21</span><span class="n">facet_tag</span> <span class="o">=</span> <span class="n">meshtags</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span> <span class="n">fdim</span><span class="p">,</span> <span class="n">facet_indices</span><span class="p">[</span><span class="n">sorted_facets</span><span class="p">],</span> <span class="n">facet_markers</span><span class="p">[</span><span class="n">sorted_facets</span><span class="p">])</span>
<span class="linenos">22</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">msh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="n">facet_tag</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="instantiation-of-the-objects">
<h3>Instantiation of the objects<a class="headerlink" href="#instantiation-of-the-objects" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>We instantiate the objects of the following classes:</dt><dd><ul class="simple">
<li><p>Reinitialization (<code class="xref py py-meth docutils literal notranslate"><span class="pre">levelSet_tool.Reinitialization()</span></code>),</p></li>
<li><p>ErsatzMethod  (<code class="xref py py-meth docutils literal notranslate"><span class="pre">ersatz_method.ErsatzMethod()</span></code>),</p></li>
<li><p>CutFemMethod (<code class="xref py py-meth docutils literal notranslate"><span class="pre">cutfem_method.CutFemMethod()</span></code>).</p></li>
</ul>
</dd>
</dl>
<p>Then, we initialize the coefficients of Lamé with the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">mechanics_tool.lame_compute()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">Reinitialization</span> <span class="o">=</span> <span class="n">Reinitialization</span><span class="p">(</span><span class="n">ls_func</span><span class="p">,</span> <span class="n">V_ls</span><span class="o">=</span><span class="n">V_ls</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">l_reinit</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">ErsatzMethod</span> <span class="o">=</span> <span class="n">ErsatzMethod</span><span class="p">(</span><span class="n">ls_func</span><span class="p">,</span><span class="n">V_ls</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">CutFemMethod</span> <span class="o">=</span> <span class="n">CutFemMethod</span><span class="p">(</span><span class="n">ls_func</span><span class="p">,</span><span class="n">V_ls</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">bc</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span><span class="p">)</span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="n">lame_mu</span><span class="p">,</span><span class="n">lame_lambda</span> <span class="o">=</span> <span class="n">mechanics_tool</span><span class="o">.</span><span class="n">lame_compute</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">young_modulus</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">poisson</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="instantiation-of-problem-class">
<h3>Instantiation of Problem class<a class="headerlink" href="#instantiation-of-problem-class" title="Link to this heading"></a></h3>
<p>We instantiate the problem class.
Here, we aim to minimize the compliance, so the problem is of the Compliance_Problem class.
Defining the problem object then allows for automating the call of functions to calculate the cost, its integrand,
the integrand of the cost’s derivative, the constraint value, the integrand of the constraint, the integrand of the derivative of the constraint,
and the dual operator if necessary. See <code class="xref py py-meth docutils literal notranslate"><span class="pre">problem.Compliance_Problem()</span></code> for clarification.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">problem_topo</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">Compliance_Problem</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="resolution-of-linear-elasticity">
<h3>Resolution of linear elasticity<a class="headerlink" href="#resolution-of-linear-elasticity" title="Link to this heading"></a></h3>
<p>Our code offers two methods for the optimization problem: the ersatz material method and the CutFEM method.
Here, we demonstrate the implementation of both methods for solving the linear elasticity problem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">cutFEM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 2</span>        <span class="n">CutFemMethod</span><span class="o">.</span><span class="n">set_measure_dxq</span><span class="p">(</span><span class="n">ls_func</span><span class="p">)</span>
<span class="linenos"> 3</span>        <span class="n">uh</span> <span class="o">=</span> <span class="n">CutFemMethod</span><span class="o">.</span><span class="n">primal_problem</span><span class="p">(</span><span class="n">ls_func_temp</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>        <span class="n">measure</span> <span class="o">=</span> <span class="n">CutFemMethod</span><span class="o">.</span><span class="n">dxq</span>
<span class="linenos"> 6</span><span class="k">else</span><span class="p">:</span>
<span class="linenos"> 7</span>        <span class="n">xsi</span> <span class="o">=</span> <span class="n">ErsatzMethod</span><span class="o">.</span><span class="n">heaviside</span><span class="p">(</span><span class="n">ls_func</span><span class="p">)</span>
<span class="linenos"> 8</span>        <span class="n">uh</span> <span class="o">=</span> <span class="n">ErsatzMethod</span><span class="o">.</span><span class="n">primal_problem</span><span class="p">(</span><span class="n">ls_func_temp</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>        <span class="n">measure</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">dx</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">cost</span> <span class="o">=</span> <span class="n">problem_topo</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">uh</span><span class="p">,</span><span class="n">ph</span><span class="p">,</span><span class="n">lame_mu</span><span class="p">,</span><span class="n">lame_lambda</span><span class="p">,</span><span class="n">measure</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span>
</pre></div>
</div>
<div class="images-row docutils container">
<div class="centered-figure docutils container">
<figure class="align-center" id="id6">
<span id="dispcutfem"></span><a class="reference internal image-reference" href="_images/dispCutFEM.png"><img alt="Exemple d'image" src="_images/dispCutFEM.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 17 </span><span class="caption-text">Displacement field of the first iteration with CutFEM.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
<div class="centered-figure docutils container">
<figure class="align-center" id="id7">
<span id="dispersatz"></span><a class="reference internal image-reference" href="_images/dispErsatz.png"><img alt="Exemple d'image" src="_images/dispErsatz.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 18 </span><span class="caption-text">Displacement field of the first iteration with Ersatz method.</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To remind, the differences CutFEM and Ersatz primal problem are defined in <a class="reference internal" href="demo_cutfem_optim.html#equation-eq-20">(17)</a> and in <a class="reference internal" href="demo_optim.html#equation-eqn-elasticity-weak-form">(5)</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The heaviside function is needed for the ersatz method. The definition is given by <a class="reference internal" href="demo_cutfem.html#equation-eqn-smooth-heaviside">(14)</a> and we choose <span class="math notranslate nohighlight">\(\varepsilon=0.001\)</span>.</p>
</div>
</section>
<section id="shape-derivative-computation">
<h3>Shape derivative computation<a class="headerlink" href="#shape-derivative-computation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">shape_derivative</span> <span class="o">=</span> <span class="n">problem_topo</span><span class="o">.</span><span class="n">shape_derivative_integrand</span><span class="p">(</span><span class="n">uh</span><span class="p">,</span><span class="n">ph</span><span class="p">,</span><span class="n">lame_mu</span><span class="p">,</span><span class="n">lame_lambda</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">rest_constraint</span> <span class="o">=</span> <span class="n">problem_topo</span><span class="o">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">uh</span><span class="p">,</span><span class="n">lame_mu</span><span class="p">,</span><span class="n">lame_lambda</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">measure</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">parameters</span><span class="o">.</span><span class="n">cutFEM</span><span class="p">)</span><span class="o">*</span><span class="n">xsi</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">shape_derivative_integrand_constraint</span> <span class="o">=</span> <span class="n">problem_topo</span><span class="o">.</span><span class="n">shape_derivative_integrand_constraint</span><span class="p">(</span><span class="n">uh</span><span class="p">,</span><span class="n">ph</span><span class="p">,</span><span class="n">lame_mu</span><span class="p">,</span><span class="n">lame_lambda</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the compliance minimization the dual solution is automatically initialized as zero function.</p>
</div>
</section>
<section id="update-alm-parameters">
<h3>Update ALM parameters<a class="headerlink" href="#update-alm-parameters" title="Link to this heading"></a></h3>
<p>To update the Augmented Lagrangian parameters we call the <code class="xref py py-meth docutils literal notranslate"><span class="pre">almMethod.maj_param_constraint_optim()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">almMethod</span><span class="o">.</span><span class="n">maj_param_constraint_optim</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span><span class="n">rest_constraint</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To simplify, the penalization method can also be used by simply initializing parameters.ALM to 0. The penalization value must be chosen very carefully, depending on the problem.</p>
</div>
</section>
<section id="compute-the-descent-direction">
<h3>Compute the descent direction<a class="headerlink" href="#compute-the-descent-direction" title="Link to this heading"></a></h3>
<p>To compute the advection velocity, we first call on of this two functions :</p>
<ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">cutfem_method.CutFemMethod.descent_direction()</span></code></p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">ersatz_method.ErsatzMethod.descent_direction()</span></code></p></li>
</ul>
<p>depending on the chosen method.</p>
<p>Next, we normalize the solution field using an adaptation of the H1 norm by calling the function  <code class="xref py py-meth docutils literal notranslate"><span class="pre">cutfem_method.CutFemMethod.velocity_normalization()</span></code> .
Finally, we compute the maximum of the velocity field to determine a time step for advection that satisfies the CFL condition.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">velocity_field</span> <span class="o">=</span> <span class="n">problem_topo</span><span class="o">.</span><span class="n">descent_direction</span><span class="p">(</span><span class="n">CutFemMethod</span><span class="o">.</span><span class="n">level_set</span><span class="p">,</span><span class="n">msh</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">bc_velocity</span><span class="p">,</span><span class="n">V_ls</span><span class="p">,</span>\
<span class="linenos">2</span>                                    <span class="n">V_DG</span><span class="p">,</span><span class="n">rest_constraint</span><span class="p">,</span><span class="n">shape_derivative_integrand_constraint</span><span class="p">,</span><span class="n">shape_derivative</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">velocity_field</span> <span class="o">=</span> <span class="n">CutFemMethod</span><span class="o">.</span><span class="n">velocity_normalization</span><span class="p">(</span><span class="n">velocity_field</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">alpha_reg_velocity</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">velocity_expr</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">velocity_field</span><span class="p">,</span> <span class="n">V_ls</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">interpolation_points</span><span class="p">())</span>
<span class="linenos">6</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V_ls</span><span class="p">)</span>
<span class="linenos">7</span><span class="n">velocity</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">velocity_expr</span><span class="p">)</span>
<span class="linenos">8</span>
<span class="linenos">9</span><span class="n">max_velocity</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">allreduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[:])),</span><span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">MAX</span><span class="p">)</span>
</pre></div>
</div>
<div class="centered-figure docutils container">
<figure class="align-center" id="id8">
<span id="velocity-field"></span><a class="reference internal image-reference" href="_images/velocity_field.png"><img alt="Exemple d'image" src="_images/velocity_field.png" style="width: 70%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 19 </span><span class="caption-text">Velocity field of the first iteration.</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
</section>
<section id="advection-of-the-level-set-function">
<h3>Advection of the level set function<a class="headerlink" href="#advection-of-the-level-set-function" title="Link to this heading"></a></h3>
<p>To advect the level set in the computed descent direction, we call the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">cutfem_method.CutFemMethod.cut_fem_adv()</span></code>.
To optimize our code, we first call <code class="xref py py-meth docutils literal notranslate"><span class="pre">opti_tool.adapt_c_HJ()</span></code>, which optimizes the choice of the parameter c when computing the advection time step.
This function uses the evolution of the convergence criterion to gradually decrease the value of c. Then, the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">opti_tool.adapt_dt()</span></code> is
called to adjust the advection time step.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">c_param_HJ</span> <span class="o">=</span> <span class="n">opti_tool</span><span class="o">.</span><span class="n">adapt_c_HJ</span><span class="p">(</span><span class="n">c_param_HJ</span><span class="p">,</span><span class="n">crit</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">tol_cost_func</span><span class="p">,</span><span class="n">lagrangian</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">parameters</span><span class="o">.</span><span class="n">dt</span>  <span class="o">=</span>  <span class="n">opti_tool</span><span class="o">.</span><span class="n">adapt_dt</span><span class="p">(</span><span class="n">lagrangian_cost</span><span class="p">,</span><span class="n">lagrangian_cost_previous</span><span class="p">,</span><span class="n">max_velocity</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">c_param_HJ</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">ls_func_temp</span> <span class="o">=</span> <span class="n">CutFemMethod</span><span class="o">.</span><span class="n">cut_fem_adv</span><span class="p">(</span><span class="n">ls_func_temp</span><span class="p">,(</span><span class="mi">1</span><span class="o">/</span><span class="n">adv_bool</span><span class="p">)</span><span class="o">*</span><span class="n">parameters</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">velocity_field</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reinitialization-of-the-level-set">
<h3>Reinitialization of the level set<a class="headerlink" href="#reinitialization-of-the-level-set" title="Link to this heading"></a></h3>
<p>To reinitialize the level set using the P.C. method after setting the number of frequency for the
reinitialization to parameters.step_reinit we call the method <code class="xref py py-meth docutils literal notranslate"><span class="pre">levelSet_tool.Reinitialization.reinitializationPC()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">if</span> <span class="p">((</span><span class="n">j</span><span class="o">%</span><span class="n">parameters</span><span class="o">.</span><span class="n">freq_reinit</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
<span class="linenos">2</span>        <span class="n">ls_func_temp</span><span class="p">,</span> <span class="n">temp_func</span> <span class="o">=</span> <span class="n">Reinitialization</span><span class="o">.</span><span class="n">reinitializationPC</span><span class="p">(</span><span class="n">ls_func_temp</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">step_reinit</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The frequency of the reinitialization is the number of iterations of optimization problem we want to do after reinitialized the level set function.
For this exemple we set it to <span class="math notranslate nohighlight">\(1\)</span>.</p>
</div>
<div class="images-row docutils container">
<div class="centered-figure docutils container">
<figure class="align-center" id="id9">
<a class="reference internal image-reference" href="_images/levelSetInit.png"><img alt="Exemple d'image" src="_images/levelSetInit.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 20 </span><span class="caption-text">Initialization of the level set.</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
<div class="centered-figure docutils container">
<figure class="align-center" id="id10">
<span id="levelsetreinit"></span><a class="reference internal image-reference" href="_images/levelSetReinit.png"><img alt="Exemple d'image" src="_images/levelSetReinit.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 21 </span><span class="caption-text">Reinitialized level set function.</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
<div class="images-row docutils container">
<div class="centered-figure docutils container">
<figure class="align-center" id="id11">
<a class="reference internal image-reference" href="_images/levelSetInitWarp.png"><img alt="Exemple d'image" src="_images/levelSetInitWarp.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 22 </span><span class="caption-text">Initialization of the level set.</span><a class="headerlink" href="#id11" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
<div class="centered-figure docutils container">
<figure class="align-center" id="id12">
<span id="levelsetreinitwarp"></span><a class="reference internal image-reference" href="_images/levelSetReinitWarp.png"><img alt="Exemple d'image" src="_images/levelSetReinitWarp.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 23 </span><span class="caption-text">Reinitialized level set function.</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="update-all-the-parameters">
<h3>Update all the parameters<a class="headerlink" href="#update-all-the-parameters" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">parameters</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">adv_bool</span> <span class="o">=</span> <span class="n">opti_tool</span><span class="o">.</span><span class="n">catch_NAN</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span><span class="n">lagrangian_cost</span><span class="p">,</span><span class="n">rest_constraint</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="n">adv_bool</span><span class="p">)</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">if</span> <span class="n">adv_bool</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
<span class="linenos">4</span>        <span class="n">parameters</span><span class="o">.</span><span class="n">j_max</span> <span class="o">=</span> <span class="n">opti_tool</span><span class="o">.</span><span class="n">vm_adapta_HJ</span><span class="p">(</span><span class="n">lagrangian_cost</span><span class="p">,</span><span class="n">lagrangian_cost_previous</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">j_max</span><span class="p">,</span><span class="n">parameters</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span>
<span class="linenos">5</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">6</span>        <span class="n">parameters</span><span class="o">.</span><span class="n">j_max</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="cutfem-solution">
<span id="finalrescutfem"></span><h3>CutFEM solution<a class="headerlink" href="#cutfem-solution" title="Link to this heading"></a></h3>
<p>The results of the optimization with the CutFEM method, obtained after a fixed number of iterations set to 300,
are provided below. The geometry of the domain obtained corresponds to the usual results found in the
literature. It is observed that the constraint imposed on the volume is well satisfied.</p>
<video width="640" height="480" controls>
    <source src="_static/output_CutFEM.mp4" type="video/mp4">
    Your browser does not support the video tag.
</video></section>
<section id="ersatz-solution">
<span id="finalresersatz"></span><h3>Ersatz solution<a class="headerlink" href="#ersatz-solution" title="Link to this heading"></a></h3>
<p>The results of the optimization with the fictitious material method, obtained after a fixed number of
iterations set to 300, are provided below. The geometry of the domain is very similar to the previous one,
obtained with CutFEM. It is observed that the constraint imposed on the volume is also well satisfied.</p>
<video width="640" height="480" controls>
    <source src="_static/output_Ersatz.mp4" type="video/mp4">
    Your browser does not support the video tag.
</video></section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="demos.html" class="btn btn-neutral float-left" title="Demos" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="demo_vonMises.html" class="btn btn-neutral float-right" title="Lp norm of Von Mises criteria minimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, ONERA and MINES PARIS - PSL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>